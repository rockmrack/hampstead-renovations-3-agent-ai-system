# ═══════════════════════════════════════════════════════════════════════════════
# HAMPSTEAD RENOVATIONS - 3-AGENT AI SYSTEM
# Environment Configuration Template
# ═══════════════════════════════════════════════════════════════════════════════
#
# INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.example .env
# 2. Fill in all required values (marked with REQUIRED)
# 3. Never commit .env to version control
#
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# GENERAL CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

# Environment: development | staging | production
NODE_ENV=production
ENVIRONMENT=production

# Application URLs
APP_URL=https://hampsteadrenovations.co.uk
API_URL=https://api.hampsteadrenovations.co.uk
N8N_URL=https://n8n.hampsteadrenovations.co.uk

# Timezone
TZ=Europe/London
GENERIC_TIMEZONE=Europe/London

# ─────────────────────────────────────────────────────────────────────────────────
# n8n CONFIGURATION (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

N8N_HOST=n8n.hampsteadrenovations.co.uk
N8N_PORT=5678
N8N_PROTOCOL=https

# Basic auth for n8n UI
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your-secure-password-here

# Webhook URL base
WEBHOOK_URL=https://n8n.hampsteadrenovations.co.uk/

# Execution settings
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168

# ─────────────────────────────────────────────────────────────────────────────────
# AI PROVIDERS (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

# Anthropic Claude (Primary)
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxx
CLAUDE_MODEL=claude-sonnet-4-5-20250514
CLAUDE_MAX_TOKENS=4096

# OpenAI (Fallback)
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxx
OPENAI_MODEL=gpt-4-turbo-preview

# ─────────────────────────────────────────────────────────────────────────────────
# CRM - HUBSPOT (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

HUBSPOT_API_KEY=pat-eu1-xxxxxxxxxxxxxxxxxxxx
HUBSPOT_PORTAL_ID=12345678

# Pipeline IDs (obtain from HubSpot)
HUBSPOT_PIPELINE_ID=default
HUBSPOT_PIPELINE_STAGE_NEW=appointmentscheduled
HUBSPOT_PIPELINE_STAGE_CONTACTED=qualifiedtobuy
HUBSPOT_PIPELINE_STAGE_SURVEY=presentationscheduled
HUBSPOT_PIPELINE_STAGE_QUOTE=decisionmakerboughtin
HUBSPOT_PIPELINE_STAGE_WON=closedwon
HUBSPOT_PIPELINE_STAGE_LOST=closedlost

# ─────────────────────────────────────────────────────────────────────────────────
# WHATSAPP - 360DIALOG (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

WHATSAPP_API_URL=https://waba.360dialog.io/v1
WHATSAPP_API_KEY=your-360dialog-api-key
WHATSAPP_PHONE_NUMBER_ID=your-phone-number-id
WHATSAPP_BUSINESS_ACCOUNT_ID=your-business-account-id

# WhatsApp webhook verification token
WHATSAPP_VERIFY_TOKEN=your-webhook-verify-token

# ─────────────────────────────────────────────────────────────────────────────────
# VOICE - TWILIO (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your-auth-token
TWILIO_PHONE_NUMBER=+447xxxxxxxxx

# IVR Settings
TWILIO_SALES_FORWARD_NUMBER=+447xxxxxxxxx
TWILIO_OFFICE_FORWARD_NUMBER=+447xxxxxxxxx
TWILIO_VOICEMAIL_MAX_SECONDS=120

# ─────────────────────────────────────────────────────────────────────────────────
# TRANSCRIPTION - DEEPGRAM (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

DEEPGRAM_API_KEY=your-deepgram-api-key
DEEPGRAM_MODEL=nova-2
DEEPGRAM_LANGUAGE=en-GB

# ─────────────────────────────────────────────────────────────────────────────────
# AWS CONFIGURATION (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

AWS_REGION=eu-west-2
AWS_ACCESS_KEY_ID=AKIAXXXXXXXXXXXX
AWS_SECRET_ACCESS_KEY=your-secret-access-key

# S3 Buckets
AWS_S3_BUCKET=hampstead-renovations-docs
AWS_S3_BUCKET_QUOTES=hampstead-renovations-quotes
AWS_S3_BUCKET_CONTRACTS=hampstead-renovations-contracts
AWS_S3_BUCKET_INVOICES=hampstead-renovations-invoices

# S3 presigned URL expiration (seconds)
S3_URL_EXPIRATION=2592000

# ─────────────────────────────────────────────────────────────────────────────────
# DATABASE - POSTGRESQL (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=hampstead
POSTGRES_USER=hampstead
POSTGRES_PASSWORD=your-secure-db-password

# Connection string
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Connection pool
DATABASE_POOL_SIZE=10
DATABASE_POOL_OVERFLOW=5

# ─────────────────────────────────────────────────────────────────────────────────
# CACHE - REDIS
# ─────────────────────────────────────────────────────────────────────────────────

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}

# ─────────────────────────────────────────────────────────────────────────────────
# CLOUDFLARE TUNNEL (REQUIRED FOR PRODUCTION)
# ─────────────────────────────────────────────────────────────────────────────────

CLOUDFLARE_TUNNEL_TOKEN=your-tunnel-token
CLOUDFLARE_ZONE_ID=your-zone-id

# ─────────────────────────────────────────────────────────────────────────────────
# MICROSOFT 365 (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

MICROSOFT_CLIENT_ID=your-client-id
MICROSOFT_CLIENT_SECRET=your-client-secret
MICROSOFT_TENANT_ID=your-tenant-id
MICROSOFT_REDIRECT_URI=https://n8n.hampsteadrenovations.co.uk/rest/oauth2-credential/callback

# Booking business ID (Microsoft Bookings)
MICROSOFT_BOOKING_BUSINESS_ID=your-booking-business-id

# Default from email
DEFAULT_FROM_EMAIL=info@hampsteadrenovations.co.uk

# ─────────────────────────────────────────────────────────────────────────────────
# NOTIFICATIONS - SLACK (REQUIRED)
# ─────────────────────────────────────────────────────────────────────────────────

SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/xxx/xxx
SLACK_BOT_TOKEN=xoxb-xxxxxxxxxxxx
SLACK_CHANNEL_LEADS=#leads
SLACK_CHANNEL_ALERTS=#alerts
SLACK_CHANNEL_SALES=#sales

# ─────────────────────────────────────────────────────────────────────────────────
# PAYMENTS - STRIPE (OPTIONAL)
# ─────────────────────────────────────────────────────────────────────────────────

STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxx
STRIPE_PUBLISHABLE_KEY=pk_live_xxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxx

# ─────────────────────────────────────────────────────────────────────────────────
# QUOTE BUILDER CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

QUOTE_BUILDER_PORT=8000
QUOTE_VALIDITY_DAYS=30
QUOTE_VAT_RATE=0.20

# London labour multiplier (SE England = 1.0)
LONDON_LABOUR_MULTIPLIER=1.34

# Company details for documents
COMPANY_NAME=Hampstead Renovations Ltd
COMPANY_ADDRESS=Unit 3, Palace Court, 250 Finchley Road, London NW3 6DN
COMPANY_PHONE=020 7946 0958
COMPANY_EMAIL=info@hampsteadrenovations.co.uk
COMPANY_WEBSITE=www.hampsteadrenovations.co.uk
COMPANY_NUMBER=12345678
COMPANY_VAT_NUMBER=GB 123 4567 89

# ─────────────────────────────────────────────────────────────────────────────────
# MONITORING & OBSERVABILITY (OPTIONAL)
# ─────────────────────────────────────────────────────────────────────────────────

# Sentry error tracking
SENTRY_DSN=https://xxxx@sentry.io/xxxx

# Prometheus metrics
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000
GRAFANA_ADMIN_PASSWORD=your-grafana-password

# Health check endpoints
HEALTHCHECK_INTERVAL=30
HEALTHCHECK_TIMEOUT=10

# ─────────────────────────────────────────────────────────────────────────────────
# RATE LIMITING
# ─────────────────────────────────────────────────────────────────────────────────

# API rate limits (requests per minute)
RATE_LIMIT_WEBHOOK=100
RATE_LIMIT_API=60
RATE_LIMIT_QUOTE=10

# ─────────────────────────────────────────────────────────────────────────────────
# FEATURE FLAGS
# ─────────────────────────────────────────────────────────────────────────────────

FEATURE_AUTO_SURVEY_BOOKING=true
FEATURE_AI_OBJECTION_HANDLING=true
FEATURE_SLACK_NOTIFICATIONS=true
FEATURE_SMS_REMINDERS=true
FEATURE_EMAIL_TRACKING=true

# ─────────────────────────────────────────────────────────────────────────────────
# SECURITY
# ─────────────────────────────────────────────────────────────────────────────────

# JWT secret for API authentication
JWT_SECRET=your-super-secret-jwt-key-min-32-chars
JWT_EXPIRATION=86400

# Webhook signature verification
WEBHOOK_SECRET=your-webhook-signature-secret

# Encryption key for sensitive data (32 bytes, base64 encoded)
ENCRYPTION_KEY=your-32-byte-encryption-key-base64

# ─────────────────────────────────────────────────────────────────────────────────
# LOGGING
# ─────────────────────────────────────────────────────────────────────────────────

LOG_LEVEL=info
LOG_FORMAT=json
LOG_OUTPUT=stdout

# ─────────────────────────────────────────────────────────────────────────────────
# SERVICE AREA CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

# Premium postcodes (higher priority)
PREMIUM_POSTCODES=NW3,NW11,N6

# Service area postcodes
SERVICE_POSTCODES=NW3,NW6,NW11,NW2,NW8,N6,N2,N10

# Outside area handling
OUTSIDE_AREA_RESPONSE=polite_decline
